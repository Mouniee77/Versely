<Window x:Class="WpfApp1.VersesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:WpfApp1.Models"
        xmlns:conv="clr-namespace:WpfApp1.Converters"
        Title="Verses" Height="450" Width="520" WindowStartupLocation="CenterOwner" Padding="12">
  <Window.Resources>
    <conv:StringNotEmptyToVisibilityConverter x:Key="StrToVis"/>
    <conv:StringNullOrEmptyToVisibilityConverter x:Key="StrEmptyToVis"/>
  </Window.Resources>

  <Grid>
    <StackPanel>
      <TextBlock x:Name="TitleText" FontSize="18" FontWeight="Bold" Margin="0,0,0,8"/>

      <!-- Search with watermark -->
      <Grid Margin="0,0,0,8">
        <TextBox x:Name="FilterTextBox" MinWidth="220" VerticalContentAlignment="Center"/>
        <TextBlock Text="Search..." IsHitTestVisible="False" Foreground="#66000000" Margin="10,0,0,0" VerticalAlignment="Center"
                   Visibility="{Binding Text, ElementName=FilterTextBox, Converter={StaticResource StrEmptyToVis}}"/>
      </Grid>

      <ListBox x:Name="VersesList" Margin="0,0,0,8"
               VirtualizingStackPanel.IsVirtualizing="True"
               VirtualizingStackPanel.VirtualizationMode="Recycling"
               ScrollViewer.CanContentScroll="True">
        <ListBox.ItemsPanel>
          <ItemsPanelTemplate>
            <VirtualizingStackPanel/>
          </ItemsPanelTemplate>
        </ListBox.ItemsPanel>

        <ListBox.ItemTemplate>
          <DataTemplate DataType="{x:Type models:Verse}">
            <Border Style="{StaticResource CardBorder}" Margin="0,0,0,8">
              <Expander IsExpanded="False">
                <Expander.Header>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding Text}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" FontWeight="SemiBold"/>

                    <ToggleButton Grid.Column="1"
                                  IsChecked="{Binding IsFavorite, Mode=TwoWay}"
                                  Margin="8,0,0,0"
                                  Width="28" Height="28"
                                  VerticalAlignment="Center"
                                  Content="★"
                                  FontSize="14"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  ToolTip="Bookmark">
                      <ToggleButton.Style>
                        <Style TargetType="ToggleButton">
                          <Setter Property="Foreground" Value="LightGray"/>
                          <Setter Property="Cursor" Value="Hand"/>
                          <Style.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                              <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                          </Style.Triggers>
                        </Style>
                      </ToggleButton.Style>
                    </ToggleButton>
                  </Grid>
                </Expander.Header>

                <StackPanel Margin="0,8,0,0">
                  <TextBlock Text="Meaning:" FontWeight="Bold" Visibility="{Binding Meaning, Converter={StaticResource StrToVis}}"/>
                  <TextBlock Text="{Binding Meaning}" TextWrapping="Wrap" Margin="0,2,0,6" Visibility="{Binding Meaning, Converter={StaticResource StrToVis}}"/>
                  <TextBlock Text="Prayer:" FontWeight="Bold" Visibility="{Binding Prayer, Converter={StaticResource StrToVis}}"/>
                  <TextBlock Text="{Binding Prayer}" TextWrapping="Wrap" Margin="0,2,0,0" Visibility="{Binding Prayer, Converter={StaticResource StrToVis}}"/>
                </StackPanel>
              </Expander>
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

      <Button Content="Close" Width="80" HorizontalAlignment="Right" Style="{StaticResource AccentButton}" Click="Close_Click"/>
    </StackPanel>
  </Grid>
</Window>